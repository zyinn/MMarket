!function(e){"use strict";var t=e.module("moneyMarketApp");t.controller("innerFilterController",["$uibModal","$scope","areaService","innerFilterService","tableService","offerService","enumConfig","$cookies",function(t,i,a,n,r,s,o,c){var l=this;l.quoteType=[],l.areas=[],l.oldAreaList=[],n.getUserArea().success(function(t){var i=t.result;l.boardDirection=s.dataDefine.boardDirection.map(function(e){return{name:e.displayName+"理财",value:e.value}}),l.selectBoardDirection=l.boardDirection[0],l.selectBoardDirection.selected=!0,l.quoteTypeList=i[0].quote_type.slice(0,i[0].quote_type.length-1),l.quoteTypeList=[{isAll:!0,name:"全部",selected:!0}].concat(l.quoteTypeList),l.quoteType=[l.quoteTypeList[0]],l.areaList=[{isAll:!0,name:"全部",selected:!0}].concat(i[0].region.map(function(e){return{name:e.province}})),o.periodValue=i[0].period,o.quoteMethod=i[0].quote_method,l.fundSizes=i[0].fundSizes,l.bankSizeList=[{isAll:!0,name:"全部",selected:!0}],e.copy(i[0].fundSizes).forEach(function(e,t){var i=e.name;e.name=e.displayName,e.displayName=i,e.selected=!1,e.displayOrder=t+1,l.bankSizeList.push(e)}),l.calculationBankNature=i[0].calculationBankNature,l.institutionTypeList=[{isAll:!0,name:"全部",selected:!0}],e.copy(i[0].calculationBankNature).forEach(function(e,t){var i=e.name;e.name=e.displayName,e.displayName=i,e.selected=!1,e.displayOrder=t+1,"SHIBOR"!==e.displayName&&l.institutionTypeList.push(e)}),l.tags=i[0].tags,l.featureList=[{isAll:!0,name:"全部",selected:!0}],e.copy(i[0].tags).forEach(function(e,t){e.name=e.tagName,e.selected=!1,e.displayOrder=t+1,l.featureList.push(e)}),s.featureList=e.copy(l.featureList)});var u=function(){for(var e=!1,t=0;t<l.oldAreaList.length;++t){var i=l.oldAreaList[t];if(i.selected){for(var a=!1,n=0;n<l.areaList.length;++n){var r=l.areaList[n];if(r.name==i.name){r.selected=!0,a=!0;break}}if(!a){e=!0;break}}}e&&(l.areaList.forEach(function(e){e.isAll?e.selected=!0:e.selected=!1}),l.areas=[],l.filterChanged())};l.setArea=function(){a.openModal(l.areaList,function(e){n.setUserArea(e.map(function(e){return e.name})).success(function(){l.oldAreaList=l.areaList,l.areaList=[{isAll:!0,name:"全部"}].concat(e),u()})})},l.filterChanged=function(t){if(l.firstFilter=c.get("firstFilter"),void 0===l.firstFilter){var a=document.getElementById("first-filter"),n=t.clientX+"px",o=t.clientY+"px";e.element(a).css("left",n).css("top",o),l.filterTooltip=!0,c.put("firstFilter","false",{expires:new Date("January 6, 2119")})}var u=[];l.quoteType&&(u=l.quoteType.map(function(e){return e.id}),1===u.length&&void 0===u[0]&&(u=["GTF","UR2","UR3"]));var f=l.areas.map(function(e){return e.name});"全部"==f[0]&&(f=[]);var d="";d=l.selectBoardDirection[0]?l.selectBoardDirection[0].value:s.dataDefine.boardDirection[0].value;var p=[];l.institutionTypeList&&(p=l.institutionTypeList.findWhere(function(e){return e.selected===!0}).map(function(e){return e.displayName}),1===p.length&&void 0===p[0]&&(p=[]));var m=[];l.bankSizeList&&(m=l.bankSizeList.findWhere(function(e){return e.selected===!0}).map(function(e){return e.displayName}),1===m.length&&void 0===m[0]&&(m=[]));var v=[],L=[];l.featureList&&(v=l.featureList.findWhere(function(e){return e.selected===!0}).map(function(e){return e.tagCode}),L=l.featureList.findWhere(function(e){return e.selected===!0}).map(function(e){return e.tagName}),1===v.length&&void 0===v[0]&&(v=[],L=[])),r.setFilter(u,f,d,p,m,v,L),i.$emit("filterChanged","inner")},l.close=function(){l.filterTooltip=!1},i.$on("filterReset",function(e,t){var i=["GTF","UR2","UR3"];l.quoteTypeList.forEach(function(e){e.selected=!1}),l.quoteTypeList[0].selected=!0;var a=[];l.areaList.forEach(function(e){e.selected=!1}),l.areaList[0].selected=!0;var n=[];l.institutionTypeList.forEach(function(e){e.selected=!1}),l.institutionTypeList[0].selected=!0;var s=[];l.bankSizeList.forEach(function(e){e.selected=!1}),l.bankSizeList[0].selected=!0;var o=[],c=[];l.featureList.forEach(function(e){e.selected=!1}),l.featureList[0].selected=!0,r.setFilter(i,a,r.filter.direction,n,s,o,c),"myPrice"===t?r.searchType="":"mySearch"===t&&(l.isSelf=0,r.isSelf=!1)})}]),t.service("innerFilterService",["$http","appConfig",function(e,t){var i=function(){return e.post("base/init_data")},a=function(t){return e.post("base/setarea",{province:t})};this.getUserArea=i,this.setUserArea=a}])}(angular);