!function(e){"use strict";var t=e.module("moneyMarketApp");t.controller("offlineFilterController",["$uibModal","$scope","areaService","offlineFilterService","tableService","offerService","enumConfig","$cookies",function(t,i,a,r,n,s,o,c){var l=this;l.areas=[],l.oldAreaList=[],r.getUserArea().success(function(t){var i=t.result;l.boardDirection=s.dataDefine.boardDirection.map(function(e){return{name:e.displayName+"资金",value:e.value}}),l.selectBoardDirection=l.boardDirection[1],l.selectBoardDirection.selected=!0,l.trustTypeList=i[0].trust_type,l.trustTypeList[0].selected=!0,l.trustType=[l.trustTypeList[0]],l.areaList=[{isAll:!0,name:"全部",selected:!0}].concat(i[0].region.map(function(e){return{name:e.province}})),o.periodValue=i[0].period,o.quoteMethod=i[0].quote_method,l.fundSizes=i[0].fundSizes,l.bankSizeList=[{isAll:!0,name:"全部",selected:!0}],e.copy(i[0].fundSizes).forEach(function(e,t){var i=e.name;e.name=e.displayName,e.displayName=i,e.selected=!1,e.displayOrder=t+1,l.bankSizeList.push(e)}),l.calculationBankNature=i[0].calculationBankNature,l.institutionTypeList=[{isAll:!0,name:"全部",selected:!0}],e.copy(i[0].calculationBankNature).forEach(function(e,t){var i=e.name;e.name=e.displayName,e.displayName=i,e.selected=!1,e.displayOrder=t+1,"SHIBOR"!==e.displayName&&l.institutionTypeList.push(e)}),l.tags=i[0].tags,l.featureList=[{isAll:!0,name:"全部",selected:!0}],e.copy(i[0].tags).forEach(function(e,t){e.name=e.tagName,e.selected=!1,e.displayOrder=t+1,l.featureList.push(e)}),s.featureList=e.copy(l.featureList)});var u=function(){for(var e=!1,t=0;t<l.oldAreaList.length;++t){var i=l.oldAreaList[t];if(i.selected){for(var a=!1,r=0;r<l.areaList.length;++r){var n=l.areaList[r];if(n.name==i.name){n.selected=!0,a=!0;break}}if(!a){e=!0;break}}}e&&(l.areaList.forEach(function(e){e.isAll?e.selected=!0:e.selected=!1}),l.areas=[],l.filterChanged())};l.setArea=function(){a.openModal(l.areaList,function(e){r.setUserArea(e.map(function(e){return e.name})).success(function(){l.oldAreaList=l.areaList,l.areaList=[{isAll:!0,name:"全部"}].concat(e),u()})})},l.filterChanged=function(t){if(l.firstFilter=c.get("firstFilter"),void 0===l.firstFilter){var a=document.getElementById("first-filter"),r=t.clientX+"px",o=t.clientY+"px";e.element(a).css("left",r).css("top",o),l.filterTooltip=!0,c.put("firstFilter","false",{expires:new Date("January 6, 2119")})}var u="";l.trustType[0]&&(u=l.trustType[0].id);var f=l.areas.map(function(e){return e.name});"全部"==f[0]&&(f=[]);var d=void 0;d=l.selectBoardDirection[0]?l.selectBoardDirection[0].value:s.dataDefine.boardDirection[1].value;var p=[];l.institutionTypeList&&(p=l.institutionTypeList.findWhere(function(e){return e.selected===!0}).map(function(e){return e.displayName}),1===p.length&&void 0===p[0]&&(p=[]));var m=[];l.bankSizeList&&(m=l.bankSizeList.findWhere(function(e){return e.selected===!0}).map(function(e){return e.displayName}),1===m.length&&void 0===m[0]&&(m=[]));var v=[],L=[];l.featureList&&(v=l.featureList.findWhere(function(e){return e.selected===!0}).map(function(e){return e.tagCode}),L=l.featureList.findWhere(function(e){return e.selected===!0}).map(function(e){return e.tagName}),1===v.length&&void 0===v[0]&&(v=[],L=[])),n.setFilter(u,f,d,p,m,v,L),i.$emit("filterChanged","offline")},l.close=function(){l.filterTooltip=!1},i.$on("filterReset",function(e,t){var i=!1,a=[];l.areaList.forEach(function(e){e.selected=!1}),l.areaList[0].selected=!0;var r=[];l.institutionTypeList.forEach(function(e){e.selected=!1}),l.institutionTypeList[0].selected=!0;var s=[];l.bankSizeList.forEach(function(e){e.selected=!1}),l.bankSizeList[0].selected=!0;var o=[],c=[];l.featureList.forEach(function(e){e.selected=!1}),l.featureList[0].selected=!0,n.setFilter(i,a,n.filter.direction,r,s,o,c),"myPrice"===t?n.searchType="":"mySearch"===t&&(l.isSelf=0,n.isSelf=!1)})}]),t.service("offlineFilterService",["$http","appConfig",function(e,t){var i=function(){return e.post("base/init_data")},a=function(t){return e.post("base/setarea",{province:t})};this.getUserArea=i,this.setUserArea=a}])}(angular);