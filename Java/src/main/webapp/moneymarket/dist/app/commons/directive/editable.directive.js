!function(i){"use strict";i.module("directives").directive("editable",function(){var e=["$scope","$timeout","tabNavigatorService",function(e,n,t){var o,a=this;a.isRemark=void 0!=a.remark,a.isPrice=void 0!=a.price,a.isAmount=void 0!=a.amount,a.toolTipText=function(){return a.isRemark?"":a.isPrice?"请输入您的价格，不确定价格时可不输入":a.isAmount?"请输入您的数量，不确定数量时可不输入":""}(),a.beginEdit=function(i){a.isEditing=!0;var e=i.target;n(function(){e&&"TD"===e.nodeName?($(e).addClass("is-editing"),$(e).children("input").focus()):($(e).parents("td").addClass("is-editing"),$(e).next().focus())}),a.textChanged()},a.blur=function(i){a.isEditing=!1;var e=i.target;n(function(){$(e).parents("td").removeClass("is-editing")}),d()},a.textChanged=function(){a.isRemark||(a.value&&o?(d(),o=r()):o=r())};var r=function(){var i=3e3,e=n(function(){a.showTooltip=!0},i);return e},d=function(){a.showTooltip=!1,n.cancel(o)};(function(){a.isPrice&&a.isbeginediting&&(a.isEditing=!0,n(function(){$($element).addClass("is-editing"),$($element).find("input").focus()}),a.textChanged())})();a.keydown=function(o){o&&(9!==o.keyCode&&13!==o.keyCode||(o.cancelBubble=!0,t.findNextTd(o,function(t){var o=i.element(t).controller("editable");return o?(o.isEditing=!0,n(function(){$(t).addClass("is-editing"),$(t).find("input").focus()}),void o.textChanged()):void e.$emit("onTabNavigating",t)})),38===o.keyCode&&"true"===a.isalliance&&"OUT"===a.direction?(o.cancelBubble=!0,a.value="OFR"):38===o.keyCode&&"true"===a.isalliance&&"IN"===a.direction&&(o.cancelBubble=!0,a.value="BID"))},a.initInput=function(i){var e=i||window.event,n=e.target||e.srcElement;if(n&&"A"===n.nodeName){$(n).parentsUntil("tr")}}}];return{restrict:"C",templateUrl:"app/commons/directive/editable.directive.html",scope:{value:"=ngModel",remark:"@",price:"@",amount:"@",isbeginediting:"@",isalliance:"@",direction:"="},controller:e,bindToController:!0,controllerAs:"vm"}})}(angular);