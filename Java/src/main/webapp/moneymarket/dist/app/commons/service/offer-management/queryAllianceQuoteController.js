!function(t){"use strict";t.module("services").controller("queryAllianceQuoteController",["$scope","$uibModalInstance","offerService","qbService","boardQuery",function(e,a,r,i,o){function n(t,e){return t.type&&e.type?t.id-e.id:t.type&&!e.type?-1:!t.type&&e.type?1:t.daysHighValue-e.daysHighValue}var u={typeListDefine:[{displayName:"同存",value:"IBD",direction:"IN"},{displayName:"保本",value:"GTF",direction:"OUT"},{displayName:"非保本R2",value:"UR2",direction:"OUT"},{displayName:"非保本R3",value:"UR3",direction:"OUT"}],filterDefine:[{displayName:"同业存款",value:"IBD",direction:"IN",contactType:"CD"},{displayName:"同业理财",value:"^IBD",direction:"OUT",contactType:"FI"}]};e.onClickQuoteType=function(a){if(a&&a.target&&"A"===a.target.nodeName){var r=t.element(a.target).scope();r&&(e.selectType=r.item)}},e.boardListFilter=function(t,a,r){switch(e.selectType.value){case"IBD":return"IBD"===t.type.value;default:return"IBD"!==t.type.value}},e.filterContactList=function(t){return t&&!(t.length<0)&&t instanceof Array?t.findWhere(function(t){return t.quoteAttribute===e.selectType.contactType}):[]},e.onClickHeader=function(t){if(t&&t.target&&("TH"===t.target.nodeName||"I"===t.target.nodeName)){var a=t.target.attributes.getNamedItem("tag");a&&a.nodeValue&&(e.tableSorterParam?e.tableSorterParam.prop===a.nodeValue?e.tableSorterParam.asc=e.tableSorterParam.asc*-1:(e.tableSorterParam.prop=a.nodeValue,e.tableSorterParam.asc=1):e.tableSorterParam={prop:a.nodeValue,asc:1},e.boardList.sort(function(t,a){if(!e.tableSorterParam||!e.tableSorterParam.prop)return 0;switch(e.tableSorterParam.asc||(e.tableSorterParam.asc=1),e.tableSorterParam.prop){case"institution":return function(t,a){if(!t||0===t.length)return-1*e.tableSorterParam.asc;if(!a||0===a.length)return 1*e.tableSorterParam.asc;for(var r=0;r<40;){if(t[r]!==a[r])return(t[r]>a[r]?-1:1)*e.tableSorterParam.asc;r++}}(t.institutionInfo.institutionNamePY,a.institutionInfo.institutionNamePY);default:var r=JSON.parse(e.tableSorterParam.prop);if(!r)return 0;var i=function(t){return t.type===r.type||t.daysLowValue===r.daysLowValue&&t.daysHighValue===r.daysHighValue},o=t.periodList.findItem(i),n=a.periodList.findItem(i);return o&&o.period?n&&n.period?e.tableSorterParam.asc*(o.period-n.period):1*e.tableSorterParam.asc:-1*e.tableSorterParam.asc}}))}},e.isCurrentPeriodSorted=function(t){return!(!e.tableSorterParam||"institution"===e.tableSorterParam.prop)&&JSON.parse(e.tableSorterParam.prop).header===t.header},e.openQM=function(t){i.openQM(t)},e.onClickCancel=function(){a.dismiss()};(function(){e.boardQuery=o,e.periodList=t.copy(r.dataDefine.periodDefine),e.typeList=t.copy(u.filterDefine),e.selectType=e.typeList[0],e.boardList=[],o&&(e.institutionName=o.institutionName,e.lastUpdate=o.lastUpdate,o.MmQuoteWithContactDto&&o.MmQuoteWithContactDto.length>0&&o.MmQuoteWithContactDto instanceof Array&&o.MmQuoteWithContactDto.forEach(function(a,i){if(a.mmQuoteDto){var o=r.boardFactory(a.mmQuoteDto,e.periodList);o.telephone=a.telephone,o.methodType=u.typeListDefine.findItem(function(t){return t.value===a.mmQuoteDto.methodType}),o.type=u.typeListDefine.findItem(function(t){return t.value===a.mmQuoteDto.quoteType}),o.contacts=a.contacts,o.institutionInfo={institutionId:a.mmQuoteDto.institutionId,institutionName:a.mmQuoteDto.institutionName,displayName:a.mmQuoteDto.institutionName,institutionNamePY:a.mmQuoteDto.institutionNamePY},e.boardList.forEach(function(a,r){a.periodList&&a.periodList.length<o.periodList.length&&a.periodList.push.apply(a.periodList,t.copy(e.periodList).slice(a.periodList.length-o.periodList.length))}),e.boardList.push(o)}})),e.periodList.sort(n),e.boardList.forEach(function(t,e){t.periodList.sort(n)})})()}])}(angular);