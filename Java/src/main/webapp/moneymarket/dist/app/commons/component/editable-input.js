!function(e){"use strict";var t=["$scope","$timeout","tabNavigatorService","commonService",function(t,i,n,a){function l(){"true"!==r.keepOpenTooltip&&(r.showTooltip=!1),i.cancel(o)}var o,r=this,u={tooltip:{remark:"",price:"请输入您的价格，不确定价格时可不输入",amount:"请输入您的数量，不确定数量时可不输入"}};r.keydown=function(i){function a(){r.onBlur(i),n.findNextTd(i,function(i){var n=e.element(i).find("editable-input").controller("editableInput");if(!n){var a=e.element(i).controller("editable");return a&&a.beginEdit?(r.isEditing=!1,void a.beginEdit({target:i[0]})):void t.$emit("onTabNavigating",i)}r.isEditing=!1,n.beginEdit({target:i[0]})})}function o(){r.isEditing=!1,r.editingValue=r.value,l()}if(i)switch(i.keyCode){case 9:i.cancelBubble=!0,a();break;case 13:i.cancelBubble=!0,r.value=r.editingValue,a();break;case 27:i.cancelBubble=!0,o();break;case 38:i.cancelBubble=!0,"true"===r.isalliance&&"OUT"===r.direction?(i.cancelBubble=!0,r.editingValue="OFR"):"true"===r.isalliance&&"IN"===r.direction&&(i.cancelBubble=!0,r.editingValue="BID")}},r.onBlur=function(e){console.log("onBlur"),r.value=r.editingValue,r.isEditing=!1,l()},r.beginEdit=function(e){r.isEditing=!0;var t=$(e.target).parent();i(function(){t&&t.find("input").focus()}),r.showTooltip=!0},r.$onInit=function(){r.valueType&&(r.toolTipText=u.tooltip[r.valueType]),r.__defineGetter__("editingValue",function(){return this.val}),r.__defineSetter__("editingValue",function(e){if(!e)return void(this.val=e);var t=void 0;switch(r.vaildRule){case"length":e.length>200?this.val=(e+"").substring(0,200):this.val=e;break;case"int":t=Math.abs(e),!/^\d+$/.test(e)||t>99999999||0===t?(e=(e+"").substring(0,e.length-1),this.val=e):this.val=e;break;case"number":if(e+""=="OFR"||e+""=="BID")return void(this.val=e+"");var i=/^\-?\d*(\.\d{0,4})?$/;t=Math.abs(e),!i.test(e)||t>100||0===t&&e.length>=3&&(e+"").indexOf(".")===-1?this.val=(e+"").substring(0,e.length-1):"0"===(e+"").charAt(0)&&"0"===(e+"").charAt(1)?this.val=(e+"").substring(1,e.length):"-"===(e+"").charAt(0)&&"0"===(e+"").charAt(1)&&"0"===(e+"").charAt(2)?this.val="-"+(e+"").substring(2,e.length):"."===(e+"").charAt(0)?this.val="0"+(e+"").substring(0,e.length):"-"===(e+"").charAt(0)&&"."===(e+"").charAt(1)?this.val="-0."+(e+"").substring(2,e.length):this.val=e;break;default:this.val=e}}),"true"===r.keepOpenTooltip&&(r.showTooltip=!0),r.editingValue=r.value}}];e.module("components").component("editableInput",{templateUrl:"app/commons/component/editable-input.template.html",transclude:!0,bindings:{value:"<",valueType:"@",vaildRule:"@",keepOpenTooltip:"@",isalliance:"@",direction:"@"},controller:t})}(window.angular);